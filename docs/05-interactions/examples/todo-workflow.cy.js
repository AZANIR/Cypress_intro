// ***********************************************************
// Повний workflow роботи з TodoMVC
// Цей приклад демонструє повний цикл: додавання, виконання, видалення
// ***********************************************************

describe('Повний workflow TodoMVC', () => {
  beforeEach(() => {
    // Підготовка: відкриваємо сторінку перед кожним тестом
    cy.visit('/')
  })
  
  it('має виконати повний цикл: додавання → виконання → видалення', () => {
    // ============================================
    // КРОК 1: Додавання задач
    // ============================================
    
    // Додаємо першу задачу
    // cy.get('.new-todo') - знаходимо поле вводу
    // .type('Вивчити Cypress{enter}') - вводимо текст та натискаємо Enter
    cy.get('.new-todo').type('Вивчити Cypress{enter}')
    
    // Додаємо другу задачу
    cy.get('.new-todo').type('Написати тести{enter}')
    
    // Додаємо третю задачу
    cy.get('.new-todo').type('Автоматизувати тестування{enter}')
    
    // Перевіряємо, що всі три задачі додалися
    // cy.get('.todo-list li') - знаходимо всі елементи списку
    // .should('have.length', 3) - перевіряємо, що їх рівно 3
    cy.get('.todo-list li').should('have.length', 3)
    
    // Перевіряємо, що кожна задача містить правильний текст
    cy.get('.todo-list li').first().should('contain', 'Вивчити Cypress')
    cy.get('.todo-list li').eq(1).should('contain', 'Написати тести')
    cy.get('.todo-list li').last().should('contain', 'Автоматизувати тестування')
    
    // ============================================
    // КРОК 2: Відмітка задач як виконаних
    // ============================================
    
    // Відмічаємо першу задачу як виконану
    // .first() - беремо перший елемент списку
    // .find('.toggle') - знаходимо чекбокс всередині
    // .check() - відмічаємо чекбокс
    cy.get('.todo-list li').first().find('.toggle').check()
    
    // Перевіряємо, що перша задача тепер має клас 'completed'
    // .should('have.class', 'completed') - перевіряє наявність класу
    cy.get('.todo-list li').first().should('have.class', 'completed')
    
    // Відмічаємо другу задачу
    cy.get('.todo-list li').eq(1).find('.toggle').check()
    
    // Перевіряємо, що дві задачі відмічені
    // cy.get('.todo-list li.completed') - знаходимо всі відмічені задачі
    cy.get('.todo-list li.completed').should('have.length', 2)
    
    // Перевіряємо лічильник активних задач
    // Має залишитися 1 активна задача
    cy.get('.todo-count').should('contain', '1')
    
    // ============================================
    // КРОК 3: Фільтрація задач
    // ============================================
    
    // Фільтруємо тільки активні задачі
    // cy.contains('Active') - знаходимо кнопку фільтра за текстом
    // .click() - клікаємо на неї
    cy.contains('Active').click()
    
    // Перевіряємо, що відображається тільки одна активна задача
    cy.get('.todo-list li').should('have.length', 1)
    cy.get('.todo-list li').should('contain', 'Автоматизувати тестування')
    
    // Фільтруємо тільки виконані задачі
    cy.contains('Completed').click()
    
    // Перевіряємо, що відображаються дві виконані задачі
    cy.get('.todo-list li').should('have.length', 2)
    cy.get('.todo-list li').each(($el) => {
      // Перевіряємо, що кожна задача має клас 'completed'
      cy.wrap($el).should('have.class', 'completed')
    })
    
    // Повертаємося до всіх задач
    cy.contains('All').click()
    cy.get('.todo-list li').should('have.length', 3)
    
    // ============================================
    // КРОК 4: Видалення задач
    // ============================================
    
    // Видаляємо першу задачу
    // .hover() - наводимо мишку на елемент (щоб з'явилася кнопка видалення)
    // .find('.destroy') - знаходимо кнопку видалення
    // .click({ force: true }) - клікаємо (force для прихованих елементів)
    cy.get('.todo-list li').first().hover().find('.destroy').click({ force: true })
    
    // Перевіряємо, що залишилося 2 задачі
    cy.get('.todo-list li').should('have.length', 2)
    
    // Видаляємо ще одну задачу
    cy.get('.todo-list li').first().hover().find('.destroy').click({ force: true })
    
    // Перевіряємо, що залишилася 1 задача
    cy.get('.todo-list li').should('have.length', 1)
    cy.get('.todo-list li').should('contain', 'Автоматизувати тестування')
    
    // ============================================
    // КРОК 5: Очищення всіх виконаних задач
    // ============================================
    
    // Спочатку відмічаємо останню задачу
    cy.get('.todo-list li').find('.toggle').check()
    
    // Перевіряємо, що з'явилася кнопка "Clear completed"
    cy.get('.clear-completed').should('be.visible')
    
    // Клікаємо на кнопку очищення
    cy.get('.clear-completed').click()
    
    // Перевіряємо, що всі задачі видалені
    cy.get('.todo-list li').should('not.exist')
    
    // Перевіряємо, що лічильник показує 0
    cy.get('.todo-count').should('not.exist').or('contain', '0')
  })
  
  it('має перевірити правильність роботи лічильника', () => {
    // Додаємо задачі
    cy.get('.new-todo').type('Задача 1{enter}')
    cy.get('.new-todo').type('Задача 2{enter}')
    cy.get('.new-todo').type('Задача 3{enter}')
    
    // Лічильник має показувати 3
    cy.get('.todo-count').should('contain', '3')
    
    // Відмічаємо одну задачу
    cy.get('.todo-list li').first().find('.toggle').check()
    
    // Лічильник має показувати 2
    cy.get('.todo-count').should('contain', '2')
    
    // Відмічаємо ще одну
    cy.get('.todo-list li').eq(1).find('.toggle').check()
    
    // Лічильник має показувати 1
    cy.get('.todo-count').should('contain', '1')
  })
})

// Цей приклад демонструє:
// 1. Додавання задач через поле вводу
// 2. Відмітку задач як виконаних
// 3. Фільтрацію задач за станом
// 4. Видалення окремих задач
// 5. Очищення всіх виконаних задач
// 6. Перевірку лічильника активних задач
