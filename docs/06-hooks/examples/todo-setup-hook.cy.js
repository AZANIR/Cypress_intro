// ***********************************************************
// Практичний приклад з підготовкою тестових даних
// Цей приклад показує реальне використання хуків для TodoMVC
// ***********************************************************

describe('Практичний приклад з хуками для TodoMVC', () => {
  // before() - виконується один раз перед усіма тестами
  // Використовується для важких операцій
  before(() => {
    // Відкриваємо сторінку один раз
    cy.visit('/')
    cy.log('Сторінка відкрита один раз для всіх тестів')
  })
  
  // beforeEach() - виконується перед кожним тестом
  // Використовується для підготовки тестових даних
  beforeEach(() => {
    // Очищаємо попередні дані (якщо є)
    cy.get('body').then(($body) => {
      if ($body.find('.todo-list li').length > 0) {
        // Видаляємо всі задачі
        cy.get('.todo-list li').each(($el) => {
          cy.wrap($el).hover().find('.destroy').click({ force: true })
        })
      }
    })
    
    // Створюємо тестові дані - додаємо задачі
    const testTasks = [
      'Вивчити Cypress',
      'Написати тести',
      'Автоматизувати тестування'
    ]
    
    // Додаємо кожну задачу
    testTasks.forEach(task => {
      cy.get('.new-todo').type(`${task}{enter}`)
    })
    
    // Перевіряємо, що всі задачі додалися
    cy.get('.todo-list li').should('have.length', 3)
    cy.log('Тестові дані підготовлені перед тестом')
  })
  
  // afterEach() - виконується після кожного тесту
  // Використовується для очищення
  afterEach(() => {
    // Очищаємо дані після тесту
    // Відмічаємо всі задачі як виконані
    cy.get('.todo-list li').each(($el) => {
      cy.wrap($el).find('.toggle').check()
    })
    
    // Клікаємо на "Clear completed"
    cy.get('.clear-completed').click()
    
    // Перевіряємо, що всі задачі видалені
    cy.get('.todo-list li').should('not.exist')
    cy.log('Дані очищені після тесту')
  })
  
  // Тести використовують підготовлені дані
  it('має відображати підготовлені задачі', () => {
    // Тест починається з 3 задач, доданих у beforeEach()
    cy.get('.todo-list li').should('have.length', 3)
    cy.get('.todo-list li').first().should('contain', 'Вивчити Cypress')
    cy.get('.todo-list li').eq(1).should('contain', 'Написати тести')
    cy.get('.todo-list li').last().should('contain', 'Автоматизувати тестування')
  })
  
  it('має відмітити задачу як виконану', () => {
    // Починаємо з 3 задач
    cy.get('.todo-list li').should('have.length', 3)
    
    // Відмічаємо першу задачу
    cy.get('.todo-list li').first().find('.toggle').check()
    
    // Перевіряємо результат
    cy.get('.todo-list li.completed').should('have.length', 1)
    cy.get('.todo-count').should('contain', '2')
  })
  
  it('має видалити задачу', () => {
    // Починаємо з 3 задач
    cy.get('.todo-list li').should('have.length', 3)
    
    // Видаляємо першу задачу
    cy.get('.todo-list li').first().hover().find('.destroy').click({ force: true })
    
    // Перевіряємо результат
    cy.get('.todo-list li').should('have.length', 2)
  })
  
  // after() - виконується один раз після всіх тестів
  // Використовується для фінального очищення
  after(() => {
    cy.log('Всі тести завершені - фінальне очищення')
    // Можна додати фінальне очищення, якщо потрібно
  })
})

// Переваги такого підходу:
// 1. Кожен тест починається з однакового стану
// 2. Тести не залежать один від одного
// 3. Легко додавати нові тести
// 4. Очищення автоматичне
