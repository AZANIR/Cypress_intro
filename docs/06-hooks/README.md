# Тема 6: Хуки та анотації

## Цілі навчання

Після вивчення цієї теми ви зможете:

- Зрозуміти життєвий цикл тестів
- Навчитися використовувати хуки для підготовки та очищення
- Оволодіти анотаціями для керування виконанням тестів
- Створювати ефективні тести з правильною підготовкою даних

## Хуки життєвого циклу

### before() та beforeEach()

**before()** виконується один раз перед виконанням всього блоку тестів:

```javascript
describe('Блок тестів', () => {
  before(() => {
    // Код, який виконується ОДИН РАЗ перед усіма тестами
    cy.visit('/')
  });

  it('тест 1', () => {
    // Використовує стан після before()
  });

  it('тест 2', () => {
    // Також використовує стан після before()
  });
});
```

**beforeEach()** виконується перед кожним тестом у блоку:

```javascript
describe('Блок тестів', () => {
  beforeEach(() => {
    // Код, який виконується ПЕРЕД КОЖНИМ тестом
    cy.visit('/')
    cy.get('.new-todo').type('Тестова задача{enter}')
  });

  it('тест 1', () => {
    // Має свій власний стан після beforeEach()
  });

  it('тест 2', () => {
    // Має свій власний стан після beforeEach()
  });
});
```

**Коли використовувати:**
- `before()` - для важких операцій, які не змінюються (логін, завантаження даних)
- `beforeEach()` - для підготовки стану перед кожним тестом (створення тестових даних)

### after() та afterEach()

**after()** виконується один раз після виконання всього блоку тестів:

```javascript
describe('Блок тестів', () => {
  after(() => {
    // Код, який виконується ОДИН РАЗ після усіх тестів
    // Наприклад, очищення тестових даних
  });
});
```

**afterEach()** виконується після кожного тесту:

```javascript
describe('Блок тестів', () => {
  afterEach(() => {
    // Код, який виконується ПІСЛЯ КОЖНОГО тесту
    // Наприклад, видалення створених задач
    cy.get('.clear-completed').click()
  });
});
```

**Коли використовувати:**
- `after()` - для фінального очищення після всіх тестів
- `afterEach()` - для очищення після кожного тесту (рекомендовано)

## Анотації для керування тестами

### .only() - запуск лише певних тестів

Запускає тільки зазначені тести, пропускаючи інші:

```javascript
it.only('тільки цей тест буде виконаний', () => {
  // Код тесту
});

describe.only('тільки цей блок буде виконаний', () => {
  // Тести в цьому блоці
});
```

**⚠️ УВАГА:** Завжди видаляйте `.only()` перед комітом в репозиторій!

### .skip() - пропуск тестів

Пропускає виконання зазначених тестів:

```javascript
it.skip('цей тест буде пропущений', () => {
  // Код тесту не виконається
});

describe.skip('цей блок буде пропущений', () => {
  // Всі тести в блоці будуть пропущені
});
```

**Коли використовувати:**
- Для тимчасового вимкнення тестів, що не працюють
- Для тестів, що потребують доопрацювання

### .timeout() - налаштування таймаутів

Встановлює максимальний час очікування:

```javascript
it('тест з встановленням таймауту', () => {
  // Встановлюємо таймаут 10 секунд для цієї команди
  cy.get('.slow-element', { timeout: 10000 }).should('be.visible')
});
```

Або для всього тесту:

```javascript
it('тест з таймаутом', { defaultCommandTimeout: 10000 }, () => {
  // Всі команди в цьому тесті матимуть таймаут 10 секунд
});
```

### .retry() - повторні спроби

Cypress автоматично повторює команди, якщо вони не вдаються. Можна налаштувати кількість спроб:

```javascript
// Налаштування в cypress.config.js
defaultCommandTimeout: 10000  // 10 секунд
```

## Практичні сценарії

### Підготовка даних перед тестами

```javascript
describe('Робота з задачами', () => {
  beforeEach(() => {
    // Відкриваємо сторінку
    cy.visit('/')
    
    // Створюємо тестові дані
    cy.get('.new-todo').type('Задача 1{enter}')
    cy.get('.new-todo').type('Задача 2{enter}')
    cy.get('.new-todo').type('Задача 3{enter}')
  });

  it('має відображати 3 задачі', () => {
    cy.get('.todo-list li').should('have.length', 3)
  });
});
```

### Очищення після тестів

```javascript
describe('Робота з задачами', () => {
  afterEach(() => {
    // Видаляємо всі задачі після кожного тесту
    cy.get('body').then(($body) => {
      if ($body.find('.clear-completed').length > 0) {
        cy.get('.clear-completed').click()
      }
    });
    
    // Або видаляємо всі задачі вручну
    cy.get('.todo-list li').each(($el) => {
      cy.wrap($el).find('.destroy').click({ force: true })
    });
  });
});
```

## Практичні приклади

У папці `examples/` знаходяться робочі приклади:
- `before-after.cy.js` - базові хуки на TodoMVC
- `setup-teardown.cy.js` - підготовка та очищення задач
- `annotations.cy.js` - використання анотацій
- `todo-setup-hook.cy.js` - практичний приклад з підготовкою тестових даних

## Типові помилки

1. **Плутанина між `before` та `beforeEach`**
   - `before()` - один раз для всього блоку
   - `beforeEach()` - перед кожним тестом

2. **Забування очищення після тестів**
   - Завжди очищайте тестові дані в `afterEach()`
   - Це забезпечує ізоляцію тестів

3. **Неправильне використання `.only()` в продакшені**
   - Завжди перевіряйте перед комітом
   - Використовуйте тільки для локальної розробки

4. **Проблеми з порядком виконання хуків**
   - Порядок: `before()` → `beforeEach()` → `it()` → `afterEach()` → `after()`
   - Вкладені блоки виконуються зовні всередину

## Наступні кроки

Після вивчення цієї теми перейдіть до:
- [Тема 7: Конфігурація Cypress](../07-configuration/README.md)
