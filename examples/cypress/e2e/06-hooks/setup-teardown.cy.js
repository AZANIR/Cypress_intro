// ***********************************************************
// Підготовка та очищення даних
// Цей приклад показує правильне використання хуків для підготовки та очищення
// ***********************************************************

describe('Підготовка та очищення тестових даних', () => {
  // beforeEach() - підготовка перед кожним тестом
  beforeEach(() => {
    // Відкриваємо сторінку перед кожним тестом
    // Це забезпечує свіжий стан для кожного тесту
    cy.visit('/')
    
    // Додаємо тестові дані - створюємо кілька задач
    // Це підготовка стану для тестів
    cy.get('.new-todo').type('Тестова задача 1{enter}')
    cy.get('.new-todo').type('Тестова задача 2{enter}')
    cy.get('.new-todo').type('Тестова задача 3{enter}')
    
    // Перевіряємо, що задачі додалися
    cy.get('.todo-list li').should('have.length', 3)
  })
  
  // afterEach() - очищення після кожного тесту
  afterEach(() => {
    // Очищаємо тестові дані після кожного тесту
    // Це забезпечує ізоляцію тестів - кожен тест починається з чистого стану
    
    // Варіант 1: Видалити всі задачі через кнопку "Clear completed"
    // Спочатку відмічаємо всі як виконані
    cy.get('body').then(($body) => {
      // Перевіряємо, чи є задачі
      if ($body.find('.todo-list li').length > 0) {
        // Відмічаємо всі задачі
        cy.get('.todo-list li').each(($el) => {
          cy.wrap($el).find('.toggle').check()
        })
        
        // Клікаємо на "Clear completed"
        cy.get('.clear-completed').click()
      }
    })
  })
  
  it('має працювати з підготовленими даними', () => {
    // Тест починається з 3 задач, доданих у beforeEach()
    // Перевіряємо, що задачі відображаються
    cy.get('.todo-list li').should('have.length', 3)
    
    // Виконуємо дії з задачами
    cy.get('.todo-list li').first().find('.toggle').check()
    
    // Перевіряємо результат
    cy.get('.todo-list li.completed').should('have.length', 1)
  })
  
  it('має мати свіжий стан після очищення', () => {
    // Цей тест також починається з 3 задач
    // Попередній тест не впливає, бо afterEach() очистив дані
    // (але насправді beforeEach() виконається знову перед цим тестом)
    
    // Перевіряємо, що є 3 задачі
    cy.get('.todo-list li').should('have.length', 3)
  })
})

// Найкращі практики:
// 1. Використовуйте beforeEach() для підготовки стану перед кожним тестом
// 2. Використовуйте afterEach() для очищення після кожного тесту
// 3. Це забезпечує ізоляцію тестів - кожен тест незалежний
// 4. Уникайте залежності між тестами
